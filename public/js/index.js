var socket = io({transports: ['websocket'], upgrade: false});
$('#sendMessageForm').submit((e)=>{
    e.preventDefault()
    var inputMsg=$('#inputMessageBox').val()
    console.log(inputMsg)
    socket.emit('sendMessage',inputMsg)
    $('#inputMessageBox').val('')
    var myName = $('#myName').html()
    var myImg = $('#myImg').attr('src')
    console.log(myName)
    console.log(myImg)
    var divElement = $('<div class="align-self-end message send text-wrap"></div>')
    var imageElement = $('<img>',{src:myImg, class:"mx-3 rounded-circle align-self-center chat-profile-img", alt:"..."})
    var headerElement = $('<h6 class="d-inline text-white"></h6>').text(myName)
    var paraElement = $('<p class="px-3 pt-2"></p>').text(inputMsg)
    divElement.append(imageElement)
    divElement.append(headerElement)
    divElement.append(paraElement)
    $('#messageList').append(divElement)
    return false;
})
socket.on('broadcastMsg',(response)=>{
    var divElement = $('<div class="align-self-start message receive text-wrap"></div>')
    var imageElement = $('<img>',{src:"https://images.pexels.com/photos/2379005/pexels-photo-2379005.jpeg", class:"mx-3 rounded-circle align-self-center chat-profile-img", alt:"..."})
    var headerElement = $('<h6 class="d-inline text-white"></h6>').text(response.sender)
    var paraElement = $('<p class="px-3 pt-2"></p>').text(response.message)
    divElement.append(imageElement)
    divElement.append(headerElement)
    divElement.append(paraElement)
    $('#messageList').append(divElement)
})

socket.on('clientList',(clientList)=>{
    console.log(clientList)
    var newClientList = $('<ul id="userList" class="nav flex-column"></ul>')
        clientList.forEach(element => {
            var e=JSON.parse(element)
            var li = $('<li class="media"></li>')
            var img = $('<img>',{class:"mx-3 rounded-circle align-self-center chat-list-profile-img", alt:"...",src:"http://localhost:4000/chatapp/image/".concat(e.profileImage)})
            var div = $('<div class="media-body border-bottom"></div')
            var h6 = $('<h6 class="mt-0 mb-1">').text(e.username)
            var p = $('<p class="text-truncate text-muted half-status"></p>').text(' Praeterea iter est quasdam res quas ex communi.')
            div.append(h6)
            div.append(p)
            li.append(img)
            li.append(div)
            newClientList.append(li)
        });
    $("#userList").replaceWith(newClientList)
})
